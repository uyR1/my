<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å¹¸è¿å¤§è½¬ç›˜</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    #pointer {
      width: 0; height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid red;
      margin: 20px auto;
    }
    canvas { border-radius: 50%; }
  </style>
</head>
<body>
  <h1>ğŸ¯ å¹¸è¿å¤§è½¬ç›˜</h1>
  <div id="pointer"></div>
  <canvas id="wheel" width="400" height="400"></canvas><br>
  <button onclick="spin()">å¼€å§‹æŠ½å¥–</button>

  <h3>å¥–å“é…ç½®</h3>
  <textarea id="prizesInput" rows="6" cols="30"></textarea><br>
  <button onclick="savePrizes()">ä¿å­˜é…ç½®</button>

  <p id="result"></p>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    let result = document.getElementById("result");
    let prizesInput = document.getElementById("prizesInput");

    // é»˜è®¤å¥–å“
    let prizes = ["å¥–å“1", "å¥–å“2", "å¥–å“3", "å¥–å“4", "å¥–å“5", "å¥–å“6"];

    // ä»æœ¬åœ°è¯»å–é…ç½®
    if(localStorage.getItem("prizes")){
      prizes = JSON.parse(localStorage.getItem("prizes"));
      prizesInput.value = prizes.join("\n");
    } else {
      prizesInput.value = prizes.join("\n");
    }

    let currentRotation = 0;

    function drawWheel() {
      let num = prizes.length;
      let anglePer = 2 * Math.PI / num;
      let colors = ["#ff7675","#74b9ff","#55efc4","#ffeaa7","#fd79a8","#a29bfe","#fab1a0","#81ecec"];

      ctx.clearRect(0,0,400,400);

      for(let i=0;i<num;i++){
        // æ‰‡åŒºé¢œè‰²
        ctx.beginPath();
        ctx.moveTo(200,200);
        ctx.fillStyle = colors[i % colors.length];
        ctx.arc(200,200,200,i*anglePer,(i+1)*anglePer);
        ctx.fill();

        // å¥–å“æ–‡å­—
        ctx.save();
        ctx.translate(200,200);
        ctx.rotate(i*anglePer + anglePer/2);
        ctx.textAlign="right";
        ctx.fillStyle="#000";
        ctx.font="16px sans-serif";
        ctx.fillText(prizes[i], 180, 5);
        ctx.restore();
      }
    }

    function spin(){
      let rand = Math.floor(Math.random() * prizes.length);
      let degPerPrize = 360 / prizes.length;
      let stopAngle = 360 - (rand * degPerPrize + degPerPrize/2);

      currentRotation += 360*5 + stopAngle; // å¤šè½¬å‡ åœˆ
      canvas.style.transition = "transform 4s ease-out";
      canvas.style.transform = `rotate(${currentRotation}deg)`;

      setTimeout(()=>{
        result.textContent = "ç»“æœï¼š" + prizes[rand];
      }, 4000);
    }

    function savePrizes(){
      prizes = prizesInput.value.split("\n").filter(x=>x.trim()!="");
      localStorage.setItem("prizes", JSON.stringify(prizes));
      drawWheel();
      alert("é…ç½®å·²ä¿å­˜ï¼");
    }

    // åˆå§‹ç»˜åˆ¶
    drawWheel();
  </script>
</body>
</html>
