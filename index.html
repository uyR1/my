<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>幸运大转盘</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    #pointer {
      width: 0; height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid red;
      margin: 20px auto;
    }
    canvas { border-radius: 50%; }
  </style>
</head>
<body>
  <h1>🎯 幸运大转盘</h1>
  <div id="pointer"></div>
  <canvas id="wheel" width="400" height="400"></canvas><br>
  <button onclick="spin()">开始抽奖</button>

  <h3>奖品配置</h3>
  <textarea id="prizesInput" rows="6" cols="30"></textarea><br>
  <button onclick="savePrizes()">保存配置</button>

  <p id="result"></p>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    let result = document.getElementById("result");
    let prizesInput = document.getElementById("prizesInput");

    // 默认奖品
    let prizes = ["奖品1", "奖品2", "奖品3", "奖品4", "奖品5", "奖品6"];

    // 从本地读取配置
    if(localStorage.getItem("prizes")){
      prizes = JSON.parse(localStorage.getItem("prizes"));
      prizesInput.value = prizes.join("\n");
    } else {
      prizesInput.value = prizes.join("\n");
    }

    let currentRotation = 0;

    function drawWheel() {
      let num = prizes.length;
      let anglePer = 2 * Math.PI / num;
      let colors = ["#ff7675","#74b9ff","#55efc4","#ffeaa7","#fd79a8","#a29bfe","#fab1a0","#81ecec"];

      ctx.clearRect(0,0,400,400);

      for(let i=0;i<num;i++){
        // 扇区颜色
        ctx.beginPath();
        ctx.moveTo(200,200);
        ctx.fillStyle = colors[i % colors.length];
        ctx.arc(200,200,200,i*anglePer,(i+1)*anglePer);
        ctx.fill();

        // 奖品文字
        ctx.save();
        ctx.translate(200,200);
        ctx.rotate(i*anglePer + anglePer/2);
        ctx.textAlign="right";
        ctx.fillStyle="#000";
        ctx.font="16px sans-serif";
        ctx.fillText(prizes[i], 180, 5);
        ctx.restore();
      }
    }

    function spin(){
      let rand = Math.floor(Math.random() * prizes.length);
      let degPerPrize = 360 / prizes.length;
      let stopAngle = 360 - (rand * degPerPrize + degPerPrize/2);

      currentRotation += 360*5 + stopAngle; // 多转几圈
      canvas.style.transition = "transform 4s ease-out";
      canvas.style.transform = `rotate(${currentRotation}deg)`;

      setTimeout(()=>{
        result.textContent = "结果：" + prizes[rand];
      }, 4000);
    }

    function savePrizes(){
      prizes = prizesInput.value.split("\n").filter(x=>x.trim()!="");
      localStorage.setItem("prizes", JSON.stringify(prizes));
      drawWheel();
      alert("配置已保存！");
    }

    // 初始绘制
    drawWheel();
  </script>
</body>
</html>
